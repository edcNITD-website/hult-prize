{% extends 'base.html' %}
{% load static %}

{% block css %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;800;900&family=Poppins:wght@400;600;800&display=swap');

.question-page {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
}

.question-container {
    margin-top: 50px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    width: 80vw;
    gap: 20px;
    border-radius: 10px;
    padding: 50px 30px;
}

.choice-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    width: 70vw;
    padding-bottom: 20px;
}

.submit-answer:disabled {
    background-color: grey;
    cursor: not-allowed;
}

#countdown {
    font-size: 24px;
    margin-bottom: 20px;
    font-weight: 700;
}

#countdown.flashing {
    color: red;
    animation: flash 1s steps(2) infinite;
}

@keyframes flash {
    50% { opacity: 0; }
}

    .choice-container{
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 10px;
        width: 70vw;
        padding-bottom: 20px;
    }

    .choice {
        padding: 10px;
        /* border: 2px solid grey; */
        background-color: white;
        color: black;
        font-family: "Prompt";
        border-radius: 10px;
        /* box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); */
        cursor: pointer;
        font-size: 1.25rem;
    }

    .choice:hover {
        border-color: black;
    }

    .submit-answer {
        border: none;
        background-color: #e6007f;
        cursor: pointer;
        padding: 5px;
        font-size: large;
        padding: 10px 30px;
        border-radius: 20px;
        color: white;
        font-weight: 500;
    }

    .submit-answer:hover {
        background-color: #fd008b;
    }

    .choice input[type="radio"] {
        display: none;
    }

    .choice input[type="radio"]:checked+.choice {
        background-color: #d1e7ff;
        color: black;
        font-weight: bold;
    }

    body {
        /* /* background-image: url('https://wallpaperaccess.com/full/1092611.jpg'); */
        background-image: url('https://images.unsplash.com/photo-1554050857-c84a8abdb5e2?q=80&w=1527&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
        background-size: cover;
        background-repeat: no-repeat;
        animation: scrollDown 120s linear forwards;
        /* background-color: black; */
    }

    @keyframes scrollDown {
        from {
            background-position: top center;
        }

        to {
            background-position: bottom center;
        }
    }

    .question-text {
        font-family: "Prompt";
        font-weight: 800;
    }

    @media (max-width: 600px) {
        .question-container {
            width: 95vw;
            padding: 30px 20px;
        }

        .question-text {
            font-size: 1.5rem;
        }

        .choice-container {
            width: 90vw;
            grid-template-columns: 1fr;
            grid-template-rows: repeat(4, 1fr);
        }

        .choice {
            padding: 8px;
            font-size: 0.9rem;
        }

        .submit-answer {
            padding: 10px;
            font-size: 0.9rem;
        }
    }

    .leaderboard-link {
        color: white;
        text-decoration: none;
        transition: text-decoration 0.3s ease;
    }

    .leaderboard-link:hover {
        text-decoration: underline;
    }

    .arrow {
        display: inline-block;
        transition: transform 0.3s ease;
    }

    .leaderboard-link:hover .arrow {
        transform: translateX(10px);
    }

    .button-leaderboard-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        padding: 0 10px;
  }
  
</style>
{% endblock css %}

{% block body %}
<main class="question-page">
    <div class="question-container">
        <h1 class="question-text">{{ question.question_text }}</h1>
        <div id="countdown">Time left: {{ time_remaining }} seconds</div> <!-- Countdown timer -->

        {% if question.question_type == 'mcq' %}
        <form id="question-form" method="post">
            {% csrf_token %}
            <input type="hidden" name="time_remaining" id="time_remaining" value="{{ time_remaining }}">
            <div class="choice-container">
                {% for choice in question.choices.all %}
                <label class="choice">
                    <input type="radio" name="choice" value="{{ choice.id }}" onchange="enableSubmitButton()">
                    <span>{{ choice.choice_text }}</span>
                </label>
                {% endfor %}
            </div>
            <button type="submit" id="submit-button" class="submit-answer" disabled>Submit Answer</button>
        </form>
        {% elif question.question_type == 'text' %}
        <form id="question-form" method="post">
            {% csrf_token %}
            <input type="hidden" name="time_remaining" id="time_remaining" value="{{ time_remaining }}">
            <textarea name="answer" style="width: 100%; padding: 10px; border-radius: 10px; font-size: 1.1rem;" oninput="enableSubmitButton()" required></textarea><br>
            <button class="submit-answer" id="submit-button" type="submit" disabled>Submit Answer</button>
        </form>
        {% endif %}
    </div>
</main>

<script>
    // Countdown Timer
    let timeRemaining = {{ time_remaining }};
    const countdownElement = document.getElementById('countdown');

    const interval = setInterval(() => {
        if (timeRemaining <= 0) {
            clearInterval(interval);
            // Check if next_question exists in context to prevent errors
            {% if next_question %}
                window.location.href = "{% url 'quiz:display_question' next_question.id %}"; // Redirect to the next question
            {% else %}
                window.location.href = "{% url 'quiz:quiz_finished' %}"; // Redirect to finish page if no next question
            {% endif %}
        } else {
            countdownElement.textContent = `Time left: ${timeRemaining--} seconds`;
        }
    }, 1000);

    // Enable submit button when an option is selected or text is entered
    function enableSubmitButton() {
        const submitButton = document.getElementById('submit-button');
        const radioButtons = document.querySelectorAll('input[name="choice"]');
        const textarea = document.querySelector('textarea[name="answer"]');

        // Check if any radio button is checked or if the textarea is filled
        const isRadioSelected = Array.from(radioButtons).some(radio => radio.checked);
        const isTextFilled = textarea && textarea.value.trim() !== '';

        submitButton.disabled = !(isRadioSelected || isTextFilled);
    }

    // Prevent multiple submissions
    document.getElementById('question-form').addEventListener('submit', function(event) {
        document.getElementById('submit-button').disabled = true;  // Disable the button to prevent multiple submissions
    });

    // Prevent the browser back button
    window.history.pushState(null, null, window.location.href);
    window.onpopstate = function () {
        window.history.go(1);
    };
</script>
{% endblock body %}
